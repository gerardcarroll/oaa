# Imports the monkeyrunner modules used by this program
from com.android.monkeyrunner import MonkeyRunner, MonkeyDevice, MonkeyImage
import time
import sys

# Load the reference image for comparison
reference_screenshot = MonkeyRunner.loadImageFromFile('screenshots/HomeActivity_1458750985.png')

# Connects to the current device, returning a MonkeyDevice object
device = MonkeyRunner.waitForConnection()

# Installs the Android package. Notice that this method returns a boolean, so you can test
# to see if the installation worked.
if device.installPackage('./app/build/outputs/apk/OApp-debug.apk'):
    # sets a variable with the package's internal name
    package = 'com.overstock.android.prototype'

    # sets a variable with the name of an Activity in the package
    activity = '.activity.HomeActivity'

    # sets the name of the component to start
    runComponent = package + '/' + activity

    # Runs the componentecho $
    device.startActivity(component=runComponent)

    # Presses the Menu button
    # device.press('KEYCODE_MENU', MonkeyDevice.DOWN_AND_UP)
    MonkeyRunner.sleep(1)

    # Takes a screenshot
    current_activity_screenshot = device.takeSnapshot()

    # Writes the screenshot to a file
    current_activity_screenshot.writeToFile('screenshots/HomeActivity_' + str(int(time.time())) + '.png','png')

    # Take the sub-image
    sub_image = current_activity_screenshot.getSubImage((0, 0, 50, 100))
	
    if not sub_image.sameAs(reference_screenshot, 0.9):
        print "Images do not match, test failed!"
	sys.exit(1)
    else:
        print "Test passed!!"
else:
    print('*' * 50)
    print('error installing apk')
